{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
<!-- Leaflet CSS for Map -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
<style>
    .detail-hero {
        position: relative;
        height: 400px;
        width: 100%;
        overflow: hidden;
        border-radius: 16px;
        margin-bottom: 2rem;
    }

    .detail-hero img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .detail-hero-content {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 3rem;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
        color: white;
    }

    .detail-hero-content h1 {
        color: white;
        font-size: 3rem;
        margin-bottom: 0.5rem;
    }

    .detail-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 2rem;
    }

    .nav-tabs {
        display: flex;
        gap: 2rem;
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 2rem;
    }

    .nav-tabs button {
        background: none;
        border: none;
        padding: 1rem 0;
        font-size: 1rem;
        font-weight: 500;
        color: #666;
        cursor: pointer;
        position: relative;
    }

    .nav-tabs button.active {
        color: var(--text-color);
    }

    .nav-tabs button.active::after {
        content: '';
        position: absolute;
        bottom: -1px;
        left: 0;
        width: 100%;
        height: 2px;
        background-color: var(--text-color);
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    .detail-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 4rem;
    }

    .overview-section h3 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
    }

    .overview-section p {
        color: #555;
        margin-bottom: 2rem;
    }

    #map {
        height: 400px;
        border-radius: 16px;
        z-index: 10;
    }

    @media (max-width: 992px) {
        .detail-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="detail-container" style="margin-top: 2rem;">
    <!-- Title Section -->
    <div style="margin-bottom: 1rem; position: relative;">
        <a href="{% url 'home' %}"
            style="position: absolute; right: 0; top: 0; color: #888; text-decoration: none; font-size: 1.2rem;">Ã—</a>
        <h1 style="font-size: 2.5rem; margin-bottom: 0.25rem;">{{ trip.title|default:"Marsabit, Kenya" }}</h1>
        <p style="color: #666;">Detailed Satellite Itinerary</p>
    </div>

    <!-- Map View -->
    <div id="map" style="margin-bottom: 3rem;"></div>


    <!-- Trip Hero -->
    <div class="detail-hero">
        <img src="{{ trip.image_url|default:'https://images.unsplash.com/photo-1547471080-7fc2caa6f571?auto=format&fit=crop&q=80&w=1200' }}"
            alt="Destination Image">
        <div class="detail-hero-content">
            <span class="pill-tag"
                style="background-color: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.5);">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    style="vertical-align: middle; margin-right: 4px;">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                {{ trip.group_size|default:"2 Persons" }}
            </span>
            <h1>{{ trip.title|default:"Marsabit, Kenya" }}</h1>
            <p style="opacity: 0.9;">{{ trip.start_date|date:"M d, Y"|default:"Feb 18, 2026" }} - {{
                trip.end_date|date:"M d, Y"|default:"Feb 25, 2026" }}</p>
        </div>
    </div>

    <!-- Tabs and Content -->
    <div class="detail-grid">
        <div class="main-content">
            <div class="nav-tabs">
                <button class="active" onclick="switchTab('overview')">Overview</button>
                <button onclick="switchTab('itinerary')">Itinerary</button>
                <button onclick="switchTab('general')">General Information</button>
            </div>

            <div id="overview" class="tab-content active overview-section">
                <h3>Overview</h3>
                <p>{{ trip.overview }}</p>

                <h3>Highlights</h3>
                <p style="font-size: 0.85rem; color: #888; font-style: italic; margin-bottom: 1rem;">Click on any
                    highlight to view it on the map:</p>
                <ul style="list-style: disc; padding-left: 1.5rem; color: #555;">
                    <li>Explore Gof Bongole & Gof Redo</li>
                    <li>Visit Lake Paradise</li>
                    <li>Marsabit National Park</li>
                </ul>
            </div>

            <div id="itinerary" class="tab-content overview-section">
                <h3>Itinerary</h3>
                <p>Coming soon...</p>
            </div>

            <div id="general" class="tab-content overview-section">
                <h3>General Information</h3>
                <p>Coming soon...</p>
            </div>
        </div>

        <div class="sidebar">
            <!-- Small map sidebar (could mirror the large one) -->
            <div id="map-small" style="height: 300px; border-radius: 12px; margin-bottom: 1rem;"></div>
            <div
                style="background: var(--white); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border-color);">
                <h4 style="margin-bottom: 1rem;">Important Links</h4>
                <a href="#"
                    style="display: block; color: var(--primary-green); margin-bottom: 0.5rem; text-decoration: underline;">Weather
                    forecast</a>
                <a href="#" style="display: block; color: var(--primary-green); text-decoration: underline;">Local
                    transport details</a>
            </div>
        </div>
    </div>

</div>

{% endblock %}

{% block extra_scripts %}
<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script>
    // Tab switching logic
    function switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.nav-tabs button').forEach(btn => {
            btn.classList.remove('active');
        });

        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // Initialize Maps
    document.addEventListener("DOMContentLoaded", function () {
        // Dynamic coordinates from the trip model
        const lat = parseFloat("{{ trip.latitude|default:'2.3333' }}");
        const lon = parseFloat("{{ trip.longitude|default:'37.9833' }}");
        const tripCoords = [lat, lon];

        // Large Map
        const map = L.map('map').setView(tripCoords, 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Add main marker
        L.marker(tripCoords).addTo(map).bindPopup('{{ trip.destination }}').openPopup();

        // Small Map Sidebar
        const mapSmall = L.map('map-small').setView(tripCoords, 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(mapSmall);
        L.marker(tripCoords).addTo(mapSmall);
    });
</script>
{% endblock %}